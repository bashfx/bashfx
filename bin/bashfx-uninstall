#!/usr/bin/env bash
##------------------------------------------------------------------------------
##==============================================================================
	FX_INSTALLED=1

	BIN_DIR="$( cd "$(dirname "$0")"   || exit; pwd)"
	THIS_DIR="$( cd $BIN_DIR && cd ..  || exit; pwd)"
	ROOT_DIR="$( cd $THIS_DIR && cd .. || exit; pwd)"

	LIB_DIR="$THIS_DIR/lib"

##------------------------------------------------------------------------------

	if [ -d "$LIB_DIR" ]; then
		LOCAL_LIB="$LIB_DIR"
		source "$LOCAL_LIB/includelib.bash"
		require_lib "trap"
		require_lib "terminal"
		require_lib "includelib"
		require_lib "filetools"
		require_lib "sudoutils"
	else
		exit 1
	fi


##------------------------------------------------------------------------------
#if local vars exists then load those
##------------------------------------------------------------------------------


  [ -f "$FX_CONF/bashfx.conf" ] && LOCAL_CONF="$FX_CONF/bashfx.conf" \
                                || LOCAL_CONF="$PWD/bashfx.conf"

	if [ -f "$LOCAL_CONF" ]; then
		source "$LOCAL_CONF";
	fi

##------------------------------------------------------------------------------
#if local vars/conf exist try to load those
##------------------------------------------------------------------------------

	if [ -d "$HOME/.local/lib/bashfx" ]; then
		FX_PREFIX="$HOME/.local"
		FX_CONF_FILE="$FX_PREFIX/etc/bashfx.conf"
	elif [ -d "/usr/local/lib/bashfx" ]; then
		FX_PREFIX="/usr/local"
		FX_CONF_FILE="$FX_PREFIX/etc/bashfx.conf"
	fi

	[ -n "$FX_CONF_FILE" -a -f "$FX_CONF_FILE" ] && FX_INSTALLED=0

##------------------------------------------------------------------------------
#delete all the things
##------------------------------------------------------------------------------

	if [ -n "$FX_PREFIX" ]; then
	
		FX_CONF="$FX_PREFIX/bashfx/etc"
		rm -rf $HOME/.local/lib/bashfx
		conf_file="$FX_CONF/bashfx.conf"
		profile_unlink 'bashfx' "$conf_file" "$BASH_RC"
		[ -f "$PWD/bashfx.conf" ] && rm  "$PWD/bashfx.conf";
		[ -f "$conf_file" ] && rm "$conf_file";


		if [ -z "${BASH_SOURCE[1]}" ]; then
		  info "To clear BASHFX env vars, restart session to unset vars or run \n> source bashfx-vars --unset"
		fi

	else
		warn "BASHFX Prefix missing"
		exit 1
	fi

	__print "BashFX Uninstalled" "red2"
	exit 0
##------------------------------------------------------------------------------



